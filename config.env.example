# Proxmox TB4 + Ceph Configuration
# Copy this file to config.env and edit with your values
# cp config.env.example config.env

# =============================================================================
# NODE CONFIGURATION
# =============================================================================

# Node hostnames (as they appear in Proxmox cluster)
NODE1_NAME="n2"
NODE2_NAME="n3"
NODE3_NAME="n4"

# Management Network IPs (vmbr0) - Used for SSH access and cluster communication
# This is the network you'll SSH into for setup
MGMT_NETWORK="10.11.11.0/24"
NODE1_MGMT_IP="10.11.11.12"
NODE2_MGMT_IP="10.11.11.13"
NODE3_MGMT_IP="10.11.11.14"

# VM Network IPs (vmbr1) - Optional, for VM traffic
VM_NETWORK="10.1.1.0/24"
NODE1_VM_IP="10.1.1.12"
NODE2_VM_IP="10.1.1.13"
NODE3_VM_IP="10.1.1.14"

# =============================================================================
# THUNDERBOLT 4 MESH CONFIGURATION
# =============================================================================

# TB4 Network (for Ceph cluster_network)
TB4_NETWORK="10.100.0.0/24"

# TB4 Interface Names (after systemd renaming)
TB4_IFACE1="en05"
TB4_IFACE2="en06"

# TB4 MTU - Maximum for TB4 networking
TB4_MTU="65520"

# Point-to-Point Addressing (/30 subnets for each link)
# Mesh topology: N1 <-> N2 <-> N3 <-> N1 (ring)

# Node 1 TB4 IPs
NODE1_TB4_EN05_IP="10.100.0.2"    # Link to Node 2
NODE1_TB4_EN05_MASK="30"
NODE1_TB4_EN06_IP="10.100.0.5"    # Link to Node 3
NODE1_TB4_EN06_MASK="30"

# Node 2 TB4 IPs
NODE2_TB4_EN05_IP="10.100.0.6"    # Link to Node 1
NODE2_TB4_EN05_MASK="30"
NODE2_TB4_EN06_IP="10.100.0.9"    # Link to Node 3
NODE2_TB4_EN06_MASK="30"

# Node 3 TB4 IPs
NODE3_TB4_EN05_IP="10.100.0.10"   # Link to Node 2
NODE3_TB4_EN05_MASK="30"
NODE3_TB4_EN06_IP="10.100.0.14"   # Link to Node 1
NODE3_TB4_EN06_MASK="30"

# Router IDs for OpenFabric (typically .12, .13, .14 in the TB4 subnet)
NODE1_ROUTER_ID="10.100.0.12"
NODE2_ROUTER_ID="10.100.0.13"
NODE3_ROUTER_ID="10.100.0.14"

# =============================================================================
# THUNDERBOLT HARDWARE CONFIGURATION
# =============================================================================

# PCI paths for TB4 controllers (check with: lspci | grep -i thunderbolt)
# These are typical for Intel 12th/13th gen, adjust if different
TB4_PCI_PATH_0="pci-0000:00:0d.2"
TB4_PCI_PATH_1="pci-0000:00:0d.3"

# =============================================================================
# CEPH CONFIGURATION
# =============================================================================

# Ceph public network (client I/O - typically your VM network or management)
CEPH_PUBLIC_NETWORK="10.11.11.0/24"

# Ceph cluster network (OSD replication - should be TB4 network!)
CEPH_CLUSTER_NETWORK="10.100.0.0/24"

# Ceph pool settings
CEPH_POOL_NAME="cephtb4"
CEPH_POOL_PG_COUNT="256"          # ~85 PGs per OSD for 6 OSDs
CEPH_REPLICATION_SIZE="2"         # 2:1 replication for homelab
CEPH_MIN_SIZE="1"                 # Minimum replicas to accept I/O

# Ceph repository (use "no-subscription" for homelab, "test" for latest)
CEPH_REPOSITORY="test"

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Memory settings (adjust based on your RAM)
# For 64GB nodes, 12GB per OSD is recommended
OSD_MEMORY_TARGET="12884901888"          # 12GB in bytes
BLUESTORE_CACHE_SIZE="4294967296"        # 4GB in bytes

# CPU threading (for modern Intel/AMD CPUs)
OSD_OP_NUM_SHARDS="8"
OSD_OP_THREADS_PER_SHARD="2"

# Network tuning
MS_ASYNC_OP_THREADS="8"
MS_TCP_RCVBUF="134217728"                # 128MB

# Scrubbing schedule (2 AM - 6 AM to avoid peak usage)
SCRUB_BEGIN_HOUR="2"
SCRUB_END_HOUR="6"

# =============================================================================
# SSH CONFIGURATION
# =============================================================================

# SSH key to deploy (leave empty to generate new one)
SSH_KEY_PATH=""

# SSH key comment
SSH_KEY_COMMENT="proxmox-tb4-cluster"

# SSH user (typically root for Proxmox)
SSH_USER="root"

# =============================================================================
# SCRIPT BEHAVIOR
# =============================================================================

# Enable verbose output
VERBOSE="true"

# Dry run mode (show what would be done without making changes)
DRY_RUN="false"

# Confirm before each step
INTERACTIVE="true"

# Log file location
LOG_FILE="/var/log/proxmox-tb4-setup.log"
